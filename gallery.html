<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>faun5 - Gallery</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter for a clean look -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for social icons and arrows -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f8f8; /* Light background similar to the image */
        }
        /* Custom styles for the colorful dots (now pastel pink-toned) */
        .color-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 4px;
        }
        .dot-pastel-pink-1 { background-color: #fbcfe8; } /* Tailwind pink-300 */
        .dot-pastel-pink-2 { background-color: #fecdd3; } /* Tailwind rose-200 */
        .dot-pastel-purple { background-color: #e9d5ff; } /* Tailwind purple-200 */
        .dot-pastel-fuchsia { background-color: #f5d0fe; } /* Tailwind fuchsia-200 */

        /* Active filter button style */
        .filter-button.active {
            background-color: #ec4899; /* Tailwind pink-500 */
            color: #ffffff;
        }

        /* Lightbox styles */
        .lightbox-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .lightbox-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .lightbox-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #fff;
            padding: 1.5rem;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); /* shadow-2xl */
        }
        .lightbox-image {
            max-width: 100%;
            max-height: 70vh;
            object-fit: contain;
            border-radius: 0.5rem; /* rounded-lg */
        }
        .lightbox-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: none;
            border: none;
            font-size: 2.5rem;
            color: #fff;
            cursor: pointer;
            transition: color 0.2s ease, transform 0.2s ease;
            z-index: 1001;
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        .lightbox-close:hover {
            color: #f472b6; /* Tailwind pink-400 for hover */
            transform: scale(1.1);
        }
        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 3rem;
            color: #ccc;
            cursor: pointer;
            transition: color 0.2s ease;
            padding: 0.5rem;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 50%;
        }
        .lightbox-nav:hover {
            color: #fff;
            background-color: rgba(0, 0, 0, 0.5);
        }
        .lightbox-nav.left {
            left: 1rem;
        }
        .lightbox-nav.right {
            right: 1rem;
        }
        .lightbox-caption {
            margin-top: 1rem;
            font-size: 1.25rem;
            font-weight: 600;
            color: #333;
            text-align: center;
        }

        /* Custom style for gallery item image container */
        .gallery-item-image-wrapper {
            width: 100%;
            height: auto; /* Image will maintain its aspect ratio */
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .gallery-item-image-wrapper img {
            width: 100%; /* Image will fill the width of its container */
            height: auto; /* Image will maintain its aspect ratio */
            display: block; /* Remove extra space below image */
            max-width: 100%; /* Ensure image doesn't exceed its container width */
            max-height: 300px; /* Limit image height to prevent excessive vertical space */
            object-fit: contain; /* Ensure the whole image is visible within the max-height */
        }

        /* Styles for hover caption */
        .gallery-item {
            position: relative; /* Needed for absolute positioning of overlay */
            margin-bottom: 1.5rem; /* Add bottom margin for spacing between rows */
            /* Masonry.js will handle left/right positioning and top positioning */
        }
        .overlay-caption {
            position: absolute;
            bottom: 0; /* Position at the bottom */
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.7); /* Dark semi-transparent background */
            color: white;
            padding: 0.75rem; /* p-3 */
            opacity: 0; /* Hidden by default */
            transition: opacity 0.3s ease; /* Smooth transition */
            display: flex; /* Use flex for content alignment */
            flex-direction: column; /* Stack title and category vertically */
            justify-content: flex-end; /* Push content to the bottom of the overlay */
            height: 100%; /* Cover the entire image area for hover */
            box-sizing: border-box; /* Include padding in the height */
        }
        .gallery-item:hover .overlay-caption {
            opacity: 1; /* Visible on hover */
        }
        .overlay-caption p {
            margin-bottom: 0.25rem; /* Small margin between title and category */
        }
        .overlay-caption p:last-child {
            margin-bottom: 0; /* No margin for the last paragraph */
        }

        /* Masonry Container - Removed all grid properties */
        #gallery-grid {
            /* Masonry.js will handle all positioning */
            /* Ensure it's not display: grid or flex */
            margin: 0 auto; /* Center the grid */
            max-width: 1200px; /* Optional: limit overall grid width */
        }

        /* Masonry Item Widths - Defined by Tailwind's responsive classes */
        /* These classes will be dynamically added to .gallery-item */
        /* For 1 column on mobile */
        .gallery-item {
            width: 100%;
        }

        @media (min-width: 640px) { /* sm breakpoint: 2 columns */
            .gallery-item {
                width: 50%; /* Simplified width for Masonry */
            }
            .grid-item--width2 {
                width: 100%; /* Wide item takes full width of 2 columns */
            }
        }

        @media (min-width: 768px) { /* md breakpoint: 3 columns */
            .gallery-item {
                width: 33.333%; /* Simplified width for Masonry */
            }
            .grid-item--width2 {
                width: 66.666%; /* Wide item takes 2/3 width of 3 columns */
            }
        }

        @media (min-width: 1024px) { /* lg breakpoint: 4 columns */
            .gallery-item {
                width: 25%; /* Simplified width for Masonry */
            }
            .grid-item--width2 {
                width: 50%; /* Wide item takes 2/4 = 1/2 width of 4 columns */
            }
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header Section -->
    <header class="bg-white p-4 md:p-6 shadow-sm">
        <div class="container mx-auto flex flex-col md:flex-row items-center justify-between">
            <!-- Logo and Colorful Dots -->
            <div class="flex items-center mb-4 md:mb-0">
                <h1 class="text-2xl font-bold mr-2">faun5</h1>
                <div class="flex">
                    <span class="color-dot dot-pastel-pink-1"></span>
                    <span class="color-dot dot-pastel-pink-2"></span>
                    <span class="color-dot dot-pastel-purple"></span>
                    <span class="color-dot dot-pastel-fuchsia"></span>
                </div>
            </div>

            <!-- Navigation Links -->
            <nav class="flex flex-wrap justify-center md:justify-start gap-2 md:gap-4 mb-4 md:mb-0">
                <a href="index" class="bg-pink-300 text-white px-4 py-2 rounded-lg font-medium hover:bg-pink-400 transition duration-300">HOME</a>
                <a href="gallery" class="bg-pink-300 text-white px-4 py-2 rounded-lg font-medium hover:bg-pink-400 transition duration-300">GALLERY</a>
                <a href="about" class="bg-rose-200 text-white px-4 py-2 rounded-lg font-medium hover:bg-rose-300 transition duration-300">ABOUT</a>
                <a href="contact" class="bg-pink-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-pink-600 transition duration-300">CONTACT</a>
            </nav>

            <!-- Social Media Icons -->
            <div class="flex gap-4 text-xl">
                <a href="#" class="text-gray-600 hover:text-pink-600 transition duration-300"><i class="fab fa-twitter"></i></a>
                <a href="#" class="text-gray-600 hover:text-pink-600 transition duration-300"><i class="fab fa-tumblr"></i></a>
                <a href="#" class="text-gray-600 hover:text-pink-600 transition duration-300"><i class="fab fa-instagram"></i></a>
                <a href="#" class="text-gray-600 hover:text-pink-600 transition duration-300"><i class="fas fa-envelope"></i></a>
            </div>
        </div>
    </header>

    <!-- Main Content - Gallery Section -->
    <main class="container mx-auto px-4 py-8">
        <!-- Gallery Title -->
        <h2 class="text-3xl md:text-4xl font-bold text-center my-8">The GALLERY</h2>

        <!-- Filter Buttons -->
        <div class="flex flex-wrap justify-center gap-3 mb-8">
            <button class="filter-button bg-white text-gray-700 px-5 py-2 rounded-full shadow-md hover:bg-gray-100 transition duration-300" data-filter="illustration">Illustration</button>
            <button class="filter-button bg-white text-gray-700 px-5 py-2 rounded-full shadow-md hover:bg-gray-100 transition duration-300" data-filter="character-design">Character Design</button>
            <button class="filter-button bg-white text-gray-700 px-5 py-2 rounded-full shadow-md hover:bg-gray-100 transition duration-300" data-filter="sketches">Sketches</button>
            <button class="filter-button bg-pink-500 text-white px-5 py-2 rounded-full shadow-md hover:bg-pink-600 transition duration-300 active" data-filter="all">All</button>
        </div>

        <!-- Section Title for Gallery Items -->
        <h3 id="gallery-section-title" class="text-2xl font-bold text-center mb-6">ALL</h3>

        <!-- Image Gallery Grid - This will be populated by JavaScript -->
        <div id="gallery-grid">
            <!-- Artwork will be dynamically inserted here by JavaScript -->
        </div>
        <div id="loading-message" class="text-center text-gray-600 mt-8 hidden">Loading artwork...</div>
        <div id="error-message" class="text-center text-red-600 mt-8 hidden">Failed to load artwork. Please try again later.</div>
    </main>

    <!-- Footer Section (Optional, but good practice) -->
    <footer class="bg-rose-400 text-white p-6 text-center mt-12 rounded-t-lg">
        <p>&copy; 2025 faun5. All rights reserved.</p>
    </footer>

    <!-- Lightbox Overlay -->
    <div id="lightbox-overlay" class="lightbox-overlay">
        <button id="lightbox-close" class="lightbox-close">&times;</button>
        <div class="lightbox-content">
            <img id="lightbox-image" class="lightbox-image" src="" alt="Enlarged Artwork">
            <div id="lightbox-caption" class="lightbox-caption"></div>
        </div>
        <button id="lightbox-prev" class="lightbox-nav left"><i class="fas fa-chevron-left"></i></button>
        <button id="lightbox-next" class="lightbox-nav right"><i class="fas fa-chevron-right"></i></button>
    </div>

    <!-- Masonry.js CDN -->
    <script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>

    <script>
        // Helper function to convert a path/filename into a clean title
        function getTitleFromPath(path) {
            // Get the last part of the path (the filename with extension)
            const parts = path.split('/');
            const filenameWithExtension = parts[parts.length - 1];

            // Remove the file extension
            const filenameWithoutExtension = filenameWithExtension.split('.')[0];

            // Replace hyphens, underscores, AND plus signs with spaces for the title display
            // This regex now replaces '-', '_', and '+' with a space
            return filenameWithoutExtension
                .replace(/[-_+]/g, ' ')
                .split(' ')
                .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                .join(' ');
        }

        // --- Global Artwork Data (will be populated from JSON) ---
        let artworkData = [];
        let masonryInstance; // To store the Masonry instance

        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const filterButtons = document.querySelectorAll('.filter-button');
            const galleryGrid = document.getElementById('gallery-grid');
            const gallerySectionTitle = document.getElementById('gallery-section-title');
            const loadingMessage = document.getElementById('loading-message');
            const errorMessage = document.getElementById('error-message');

            const lightboxOverlay = document.getElementById('lightbox-overlay');
            const lightboxImage = document.getElementById('lightbox-image');
            const lightboxCaption = document.getElementById('lightbox-caption');
            const lightboxClose = document.getElementById('lightbox-close');
            const lightboxPrev = document.getElementById('lightbox-prev');
            const lightboxNext = document.getElementById('lightbox-next');

            let currentFilteredItems = []; // Stores the currently visible artwork data objects
            let currentImageIndex = 0; // Index of the currently displayed image in the lightbox

            // --- Functions ---

            // Initializes or re-initializes Masonry
            function initializeMasonry() {
                if (masonryInstance) {
                    masonryInstance.destroy(); // Destroy existing instance if it exists
                }
                masonryInstance = new Masonry(galleryGrid, {
                    itemSelector: '.gallery-item',
                    // Use a simple percentage for columnWidth, Masonry will handle gutters
                    columnWidth: '.gallery-item:not(.grid-item--width2)',
                    gutter: 24, // Matches Tailwind gap-6 (1.5rem = 24px)
                    percentPosition: true, // Crucial for responsive and accurate positioning
                    transitionDuration: '0.4s' // Smooth transitions for layout changes
                });
            }

            // Renders gallery items based on provided data
            function renderGallery(itemsToRender) {
                galleryGrid.innerHTML = ''; // Clear existing items
                if (itemsToRender.length === 0) {
                    galleryGrid.innerHTML = '<p class="text-center text-gray-500 col-span-full">No artwork found in this category.</p>';
                    // If no items, destroy Masonry instance to prevent errors
                    if (masonryInstance) {
                        masonryInstance.destroy();
                        masonryInstance = null;
                    }
                    return;
                }

                const fragment = document.createDocumentFragment(); // Use a document fragment for better performance

                itemsToRender.forEach((artwork, index) => {
                    const artworkTitle = getTitleFromPath(artwork.src); // Get title automatically
                    const galleryItemDiv = document.createElement('div');
                    galleryItemDiv.classList.add(
                        'gallery-item', 'bg-white', 'rounded-xl', 'shadow-lg', 'overflow-hidden',
                        'transform', 'hover:scale-105', 'transition', 'duration-300',
                        'cursor-pointer', 'relative' /* Added relative for absolute positioning of overlay */
                    );

                    // Add responsive width classes based on breakpoints
                    // These classes are crucial for Masonry to calculate column widths correctly
                    // Simplified widths to pure percentages, Masonry handles gutter
                    galleryItemDiv.classList.add('w-full'); // Default for mobile (1 column)

                    // For 2 columns (sm breakpoint)
                    if (window.innerWidth >= 640 && window.innerWidth < 768) {
                        galleryItemDiv.classList.add('sm:w-1/2');
                        if (artwork.isWide) {
                            galleryItemDiv.classList.remove('sm:w-1/2');
                            galleryItemDiv.classList.add('sm:w-full');
                        }
                    }
                    // For 3 columns (md breakpoint)
                    else if (window.innerWidth >= 768 && window.innerWidth < 1024) {
                        galleryItemDiv.classList.add('md:w-1/3');
                        if (artwork.isWide) {
                            galleryItemDiv.classList.remove('md:w-1/3');
                            galleryItemDiv.classList.add('md:w-2/3');
                        }
                    }
                    // For 4 columns (lg breakpoint)
                    else if (window.innerWidth >= 1024) {
                        galleryItemDiv.classList.add('lg:w-1/4');
                        if (artwork.isWide) {
                            galleryItemDiv.classList.remove('lg:w-1/4');
                            galleryItemDiv.classList.add('lg:w-1/2');
                        }
                    }

                    // Add Masonry.js specific class for wide items
                    if (artwork.isWide) {
                        galleryItemDiv.classList.add('grid-item--width2'); // Masonry specific class
                    }

                    // Store original artwork data on the element for lightbox to access
                    galleryItemDiv.dataset.originalIndex = artworkData.indexOf(artwork);

                    // Prepend '/images/' to the src for the actual image path, as JSON src is relative to images/
                    const fullImagePath = `/images/${artwork.src}`;

                    galleryItemDiv.innerHTML = `
                        <div class="gallery-item-image-wrapper">
                            <img src="${fullImagePath}" alt="${artworkTitle}">
                        </div>
                        <div class="overlay-caption">
                            <p class="text-lg font-semibold artwork-title">${artworkTitle}</p>
                            <p class="text-sm text-gray-300">Category: ${artwork.category.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}</p>
                        </div>
                    `;
                    fragment.appendChild(galleryItemDiv);

                    // Tell Masonry to relayout after each image loads
                    const imgElement = galleryItemDiv.querySelector('img');
                    imgElement.onload = () => {
                        if (masonryInstance) {
                            masonryInstance.layout();
                        }
                    };
                    // Also layout if image is already cached
                    if (imgElement.complete) {
                        if (masonryInstance) {
                            masonryInstance.layout();
                        }
                    }
                });

                galleryGrid.appendChild(fragment); // Append all items at once

                // Initialize Masonry after all items are added to the DOM
                initializeMasonry();

                // Layout again after a short delay to ensure all elements are rendered
                setTimeout(() => {
                    if (masonryInstance) {
                        masonryInstance.layout();
                    }
                }, 100);
            }

            // Filters artworkData and then renders the filtered subset
            function filterGallery(category) {
                currentFilteredItems = []; // Reset filtered items
                if (category === 'all') {
                    currentFilteredItems = [...artworkData]; // Copy all artwork data
                } else {
                    currentFilteredItems = artworkData.filter(artwork => artwork.category === category);
                }
                renderGallery(currentFilteredItems); // Re-render the gallery with filtered items

                // Update the section title
                if (category === 'all') {
                    gallerySectionTitle.textContent = 'ALL';
                } else {
                    const titleCaseCategory = category.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                    gallerySectionTitle.textContent = titleCaseCategory;
                }
            }

            // Opens the lightbox
            function openLightbox(artworkIndexInFilteredList) {
                const artwork = currentFilteredItems[artworkIndexInFilteredList];
                const artworkTitle = getTitleFromPath(artwork.src); // Get title automatically
                const fullImagePath = `/images/${artwork.src}`; // Full path for lightbox

                if (lightboxImage && lightboxCaption && artwork) {
                    lightboxImage.src = fullImagePath;
                    lightboxImage.alt = artworkTitle;
                    lightboxCaption.textContent = artworkTitle;
                }

                currentImageIndex = artworkIndexInFilteredList;

                if (lightboxOverlay) {
                    lightboxOverlay.classList.add('active');
                    document.body.style.overflow = 'hidden';
                } else {
                    console.error("Error: lightboxOverlay element not found. Cannot open lightbox.");
                }
            }

            // Closes the lightbox
            function closeLightbox() {
                if (lightboxOverlay) {
                    lightboxOverlay.classList.remove('active');
                    document.body.style.overflow = '';
                } else {
                    console.error("Error: lightboxOverlay element not found. Cannot close lightbox.");
                }
            }

            // Shows the next image in the lightbox
            function showNextImage() {
                if (currentFilteredItems.length === 0) return;
                currentImageIndex = (currentImageIndex + 1) % currentFilteredItems.length;
                updateLightboxImage();
            }

            // Shows the previous image in the lightbox
            function showPrevImage() {
                if (currentFilteredItems.length === 0) return;
                currentImageIndex = (currentImageIndex - 1 + currentFilteredItems.length) % currentFilteredItems.length;
                updateLightboxImage();
            }

            // Updates the lightbox image and caption
            function updateLightboxImage() {
                if (currentFilteredItems.length === 0) return;
                const artwork = currentFilteredItems[currentImageIndex];
                const artworkTitle = getTitleFromPath(artwork.src); // Get title automatically
                const fullImagePath = `/images/${artwork.src}`; // Full path for lightbox

                if (lightboxImage && lightboxCaption && artwork) {
                    lightboxImage.src = fullImagePath;
                    lightboxImage.alt = artworkTitle;
                    lightboxCaption.textContent = artworkTitle;
                }
            }

            // --- Event Listeners ---

            // Filter buttons
            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    const filterCategory = button.dataset.filter;
                    filterGallery(filterCategory);
                });
            });

            // Event delegation for gallery item clicks (since they are dynamically added)
            if (galleryGrid) {
                galleryGrid.addEventListener('click', (e) => {
                    const clickedItem = e.target.closest('.gallery-item');
                    if (clickedItem) {
                        // Find the index of the clicked item within the currentFilteredItems array
                        const originalIndex = parseInt(clickedItem.dataset.originalIndex);
                        const artworkInFullList = artworkData[originalIndex];
                        const indexInFilteredList = currentFilteredItems.indexOf(artworkInFullList);
                        if (indexInFilteredList !== -1) {
                            openLightbox(indexInFilteredList);
                        }
                    }
                });
            } else {
                console.error("Error: galleryGrid element not found. Cannot attach click listener.");
            }


            // Lightbox controls
            if (lightboxClose) {
                lightboxClose.addEventListener('click', closeLightbox);
            } else {
                console.error("Error: lightboxClose element not found. Cannot attach event listener.");
            }
            if (lightboxPrev) {
                lightboxPrev.addEventListener('click', showPrevImage);
            } else {
                console.error("Error: lightboxPrev element not found. Cannot attach event listener.");
            }
            if (lightboxNext) {
                lightboxNext.addEventListener('click', showNextImage);
            } else {
                console.error("Error: lightboxNext element not found. Cannot attach event listener.");
            }

            // Close lightbox when clicking outside the content (but not on nav buttons)
            if (lightboxOverlay) {
                lightboxOverlay.addEventListener('click', (e) => {
                    if (e.target === lightboxOverlay || e.target.closest('.lightbox-content') === null && e.target.closest('.lightbox-nav') === null) {
                        closeLightbox();
                    }
                });
            } else {
                console.error("Error: lightboxOverlay element not found. Cannot attach click listener.");
            }

            // Keyboard navigation for lightbox
            document.addEventListener('keydown', (e) => {
                if (lightboxOverlay && lightboxOverlay.classList.contains('active')) {
                    if (e.key === 'ArrowRight') {
                        showNextImage();
                    } else if (e.key === 'ArrowLeft') {
                        showPrevImage();
                    } else if (e.key === 'Escape') {
                        closeLightbox();
                    }
                }
            });

            // --- Initial Data Load and Gallery Render ---
            async function loadArtworkData() {
                loadingMessage.classList.remove('hidden');
                errorMessage.classList.add('hidden');
                try {
                    // Fetch the JSON file using an absolute path from the domain root
                    const response = await fetch('/images/gallery-data.json');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    artworkData = await response.json();
                    filterGallery('all'); // Render gallery after data is loaded
                } catch (error) {
                    console.error("Error loading artwork data:", error);
                    errorMessage.classList.remove('hidden');
                    galleryGrid.innerHTML = ''; // Clear any loading state
                } finally {
                    loadingMessage.classList.add('hidden');
                }
            }

            loadArtworkData(); // Call the function to load data when the page loads
        });
    </script>

</body>
</html>
